<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title> Ted Data </title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-collection.v1.min.js"></script>
    <script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
    <script src="https://d3js.org/d3-quadtree.v1.min.js"></script>
    <script src="https://d3js.org/d3-timer.v1.min.js"></script>
    <script src="https://d3js.org/d3-force.v1.min.js"></script>
  </head>


  <body>

    <!--Draw SVG DIV-->
    <svg id="viz"></svg>


    <script>

    var width = window.innerWidth/2,
        height = window.innerHeight/2;

    var svg = d3.select("#viz")
      .attr("width", window.innerWidth)
      .attr("height", window.innerHeight)
      .append("g")
      .attr("transform", "translate(110,110)")

    //Make a scale for circles
    var radiusScale = d3.scaleSqrt().domain([1,674]).range([10,80])

    //Start simulation (collection of forces)
    var simulation = d3.forceSimulation()
      //create a force .force("name of it", define it)
      //Moving them to center of SVG
      .force("x", d3.forceX(0).strength(.05))
      .force("y", d3.forceY(0).strength(.05))
      //Keep them from colliding (radius of the area that we want
      //collision to avoid)
      .force("noCollision", d3.forceCollide(function (d) {
        return radiusScale(d.numberTalks) + 5;
      }))

    //Create queue and function to run viz
    d3.queue()
      .defer(d3.csv, "tedData_tags.csv")
      .await(ready);

    //Function to create viz
    function ready ( error, tagnames ) {
      console.log(tagnames)

      var circles = svg.selectAll("circles")
        .data(tagnames);
      circles.enter().append("circle")
        .attr("class", "tag")
        .attr("r", function(d) {
          return radiusScale(d.numberTalks)
        })
        .attr("fill", "#e62b1e")

      //Feed simualtion the data
      simulation.nodes(tagnames)
        .on('tick', ticked)

      //Control the tick - updates data points with cx and cy
      function ticked (d) {
        circles
          .attr("cx", function (d) {
            return d.x
          })
          .attr("cy", function (d) {
            return d.y
          })
      }
    }

    </script>

  </body>

</html>
